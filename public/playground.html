<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solabs Messages MFE - Playground</title>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f5f5;
        }
        
        .playground-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-group {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .control-group h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .mfe-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 600px;
            overflow: hidden;
        }
        
        .logs {
            background: #1a1a1a;
            color: #e5e5e5;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-info { color: #3b82f6; }
        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-warning { color: #f59e0b; }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-mounted {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-unmounted {
            background: #fee2e2;
            color: #991b1b;
        }
        
        select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .performance {
            margin-top: 10px;
            padding: 10px;
            background: #f9fafb;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="playground-container">
        <div class="header">
            <h1>üöÄ Solabs Messages MFE - Playground</h1>
            <p>Ambiente de desenvolvimento para testar o Micro Frontend localmente</p>
            <div class="performance" id="performance">
                Bundle carregado em: <span id="loadTime">-</span>ms
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <h3>üîß Controles de Mount</h3>
                <div class="button-group">
                    <button class="btn-primary" onclick="mountOperator()">Mount Operator</button>
                    <button class="btn-secondary" onclick="mountAdmin()">Mount Admin</button>
                    <button class="btn-danger" onclick="unmountAll()">Unmount</button>
                </div>
                <div style="margin-top: 10px;">
                    Status: <span class="status status-unmounted" id="mountStatus">Unmounted</span>
                </div>
            </div>
            
            <div class="control-group">
                <h3>üë§ Usu√°rio & Permiss√µes</h3>
                <select id="userRole">
                    <option value="admin">Admin (admin-interno)</option>
                    <option value="user">Usu√°rio Regular</option>
                    <option value="none">Sem Permiss√µes</option>
                </select>
                <button class="btn-success" onclick="updateUser()">Aplicar</button>
                <div style="margin-top: 10px; font-size: 12px;" id="currentUser">
                    Usu√°rio atual: Admin (admin-interno)
                </div>
            </div>
            
            <div class="control-group">
                <h3>üé® Configura√ß√µes</h3>
                <div class="button-group">
                    <button class="btn-secondary" onclick="toggleTheme()">Toggle Theme</button>
                    <button class="btn-secondary" onclick="simulateError()">Simular Erro</button>
                    <button class="btn-success" onclick="clearLogs()">Limpar Logs</button>
                </div>
            </div>
        </div>
        
        <div class="mfe-container" id="mfeContainer">
            <div style="padding: 40px; text-align: center; color: #6b7280;">
                <h3>MFE Container</h3>
                <p>Clique em "Mount Operator" ou "Mount Admin" para carregar o micro frontend</p>
            </div>
        </div>
        
        <div class="logs" id="logs">
            <div class="log-entry log-info">[INFO] Playground inicializado</div>
        </div>
    </div>

    <script type="module">
        let startTime = performance.now();
        let currentMountType = null;
        let currentTheme = 'light';
        
        // Load the MFE bundle
        import('/src/mfe/publicApi.ts').then(module => {
            const loadTime = Math.round(performance.now() - startTime);
            document.getElementById('loadTime').textContent = loadTime;
            
            window.SolabsMessages = module.default;
            log('success', `Bundle carregado com sucesso (${loadTime}ms)`);
        }).catch(error => {
            log('error', `Erro ao carregar bundle: ${error.message}`);
        });
        
        function log(type, message) {
            const logs = document.getElementById('logs');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
        }
        
        function updateStatus(status) {
            const statusEl = document.getElementById('mountStatus');
            statusEl.textContent = status;
            statusEl.className = `status ${status === 'Mounted' ? 'status-mounted' : 'status-unmounted'}`;
        }
        
        function getCurrentUser() {
            const role = document.getElementById('userRole').value;
            
            const users = {
                admin: {
                    id: 1,
                    name: 'Admin User',
                    email: 'admin@test.com',
                    role: 'admin-interno',
                    roles: ['admin-interno', 'user']
                },
                user: {
                    id: 2,
                    name: 'Regular User',
                    email: 'user@test.com',
                    role: 'user',
                    roles: ['user']
                },
                none: {
                    id: 3,
                    name: 'No Permissions',
                    email: 'none@test.com',
                    role: 'guest',
                    roles: []
                }
            };
            
            return users[role];
        }
        
        function getMountOptions() {
            return {
                basePath: '/playground',
                apiBaseUrl: 'http://localhost:3001',
                theme: currentTheme,
                locale: 'pt-BR',
                currentUser: getCurrentUser(),
                chatwootAccountId: 'playground-account',
                getAuthToken: () => Promise.resolve('playground-token'),
                onResize: (height) => log('info', `Resize event: ${height}px`),
                onUnauthorized: () => log('warning', 'Acesso n√£o autorizado!')
            };
        }
        
        window.mountOperator = async function() {
            if (!window.SolabsMessages) {
                log('error', 'Bundle ainda n√£o foi carregado');
                return;
            }
            
            try {
                const container = document.getElementById('mfeContainer');
                const options = getMountOptions();
                
                log('info', 'Montando Operator App...');
                await window.SolabsMessages.mountOperator(container, options);
                
                currentMountType = 'operator';
                updateStatus('Mounted');
                log('success', 'Operator App montado com sucesso');
            } catch (error) {
                log('error', `Erro ao montar Operator: ${error.message}`);
            }
        };
        
        window.mountAdmin = async function() {
            if (!window.SolabsMessages) {
                log('error', 'Bundle ainda n√£o foi carregado');
                return;
            }
            
            try {
                const container = document.getElementById('mfeContainer');
                const options = getMountOptions();
                
                log('info', 'Montando Admin App...');
                await window.SolabsMessages.mountAdmin(container, options);
                
                currentMountType = 'admin';
                updateStatus('Mounted');
                log('success', 'Admin App montado com sucesso');
            } catch (error) {
                log('error', `Erro ao montar Admin: ${error.message}`);
            }
        };
        
        window.unmountAll = function() {
            if (!window.SolabsMessages) {
                log('error', 'Bundle ainda n√£o foi carregado');
                return;
            }
            
            try {
                const container = document.getElementById('mfeContainer');
                window.SolabsMessages.unmount(container);
                
                currentMountType = null;
                updateStatus('Unmounted');
                log('info', 'App desmontado com sucesso');
                
                // Reset container
                container.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #6b7280;">
                        <h3>MFE Container</h3>
                        <p>Clique em "Mount Operator" ou "Mount Admin" para carregar o micro frontend</p>
                    </div>
                `;
            } catch (error) {
                log('error', `Erro ao desmontar: ${error.message}`);
            }
        };
        
        window.updateUser = function() {
            const user = getCurrentUser();
            document.getElementById('currentUser').textContent = 
                `Usu√°rio atual: ${user.name} (${user.role})`;
            
            if (currentMountType) {
                log('info', `Atualizando usu√°rio para: ${user.name}`);
                // Remount with new user
                if (currentMountType === 'operator') {
                    window.mountOperator();
                } else {
                    window.mountAdmin();
                }
            }
        };
        
        window.toggleTheme = function() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            log('info', `Theme alterado para: ${currentTheme}`);
            
            if (currentMountType) {
                // Remount with new theme
                if (currentMountType === 'operator') {
                    window.mountOperator();
                } else {
                    window.mountAdmin();
                }
            }
        };
        
        window.simulateError = function() {
            log('error', 'Erro simulado: Falha na conex√£o com API');
        };
        
        window.clearLogs = function() {
            document.getElementById('logs').innerHTML = 
                '<div class="log-entry log-info">[INFO] Logs limpos</div>';
        };
    </script>
</body>
</html>